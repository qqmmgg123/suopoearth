<!DCOTYPE html>
<html lang="zh-cms-Hans">
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title><%= title %></title>
    <!-- 通用样式 -->
    <link href="/css/style.css" rel="stylesheet" type="text/css" />
    <!--[if lt IE 9]>
    <link href="/css/compatible.css" rel="stylesheet" type="text/css" />
    <![endif]-->
</head>
<body>
    <% include header.html %>
    <div class="container">
        <canvas id="sketch" width="960" height="960"></canvas>
    </div>
    <% include footer.html %>
    <% include create.html %>
</body>
<script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/jquery.mousewheel.min.js" type="text/javascript"></script>
<script src="/js/common.js" type="text/javascript"></script>
<script type="text/javascript">
    

    var canvas = document.getElementById('sketch');
    var context = canvas.getContext("2d");
    var x = 0;
    var y = 0;
    var a = 1;
    var clear = true;

/*    var bw = 400;
var bh = 400;
var p = 20;

function drawBoard(){
for (var x = 0; x <= bw; x += 20) {
    context.moveTo(0.5 + x + p, p);
    context.lineTo(0.5 + x + p, bh + p);
}


for (var x = 0; x <= bh; x += 20) {
    context.moveTo(p, 0.5 + x + p);
    context.lineTo(bw + p, 0.5 + x + p);
}

context.strokeStyle = "rgba(0, 0, 0, 0.25)";
context.stroke();
}

drawBoard();*/

    var container = [];

    var brush = {
        width: 20,
        height: 20,
        x: x,
        y: y,
        a: a,
        refresh: function() {
            this.x = x;
            this.y = y;
            this.a = a;
            return this;
        }
    };

    function draw() {
        if (canvas.getContext) {
            var ctx = canvas.getContext('2d');
            //ctx.clearRect(0, 0, 1024, 640);

            for (var i=0;i<container.length;i++) {
                var child= container[i];
                ctx.fillStyle = "rgba(0, 0, 0, " + child.a + ")";
                ctx.fillRect(child.x, child.y, 20, 20);
            }
        }
    }

    $(canvas).on('mousewheel', function(e) {
        if (e.deltaY > 0) {
            var na = a + 0.1;
            a = Math.min(1, na);
        }
        if (e.deltaY < 0) {
            var na = a - 0.1;
            a = Math.max(0, na);
        }

        draw();
    });

    $(canvas).on('mousemove', function(e) {
        var offset = $(canvas).offset();
        x = Math.floor((e.clientX - offset.left - 10)/20) * 20;
        y = Math.floor((e.clientY - offset.top - 10)/20) * 20;
        if (!clear)
            container.push(brush.refresh());
        draw();
    });

    $(canvas).on('mousedown', function(e) {
        clear = false;
    });

    $(canvas).on('mouseup', function(e) {
        clear = true;
    });
</script>
</html>
